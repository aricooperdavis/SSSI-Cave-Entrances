let map=L.map("map").setView([56,-3.5],6);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"],maxZoom:18}).addTo(map);let wms={england:{address:"http://environment.data.gov.uk/spatialdata/sites-of-special-scientific-interest-england/wms",layer:"Sites_of_Special_Scientific_Interest_England"},scotland:{address:"http://cagmap.snh.gov.uk/arcgis/services/snh_protected_sites/MapServer/WMSServer",layer:"2"},wales:{address:"http://lle.gov.wales/services/wms/nrw",layer:"NRW_SSSI"}};Object.keys(wms).forEach((e=>{wms[e].leaf=L.tileLayer.wms(wms[e].address,{layers:wms[e].layer,format:"image/png",transparent:"true",minZoom:11,opacity:"england"==e?.5:1}),wms[e].leaf.addTo(map)}));let registries={CCC:"#ff7f0e",CNCC:"#1f77b4",DCA:"#2ca02c",DCUC:"#e377c2",FoDCCAG:"#9467bd",GSG:"#8c564b",MCRA:"#d62728","Northern Caves":"#7f7f7f"},sssis={E:"https://designatedsites.naturalengland.org.uk/SiteDetail.aspx?SiteCode=S",S:"https://sitelink.nature.scot/site/",W:"https://naturalresources.wales/guidance-and-advice/environmental-topics/wildlife-and-biodiversity/protected-areas-of-land-and-seas/find-protected-areas-of-land-and-sea?lang=en&"};fetch("features.geojson").then((e=>e.json())).then((e=>{let t={};Object.keys(registries).forEach((function(r){t[r]=L.geoJSON(e,{filter:function(e,t){return e.properties.r==r},pointToLayer:function(e,t){return L.circleMarker(t,{radius:5,color:registries[e.properties.r],opacity:1,fillOpacity:.5})},onEachFeature:function(e,t){t.bindPopup(`<b>${e.properties.n}</b><br><b>SSSI</b>: <a href="${sssis[e.properties.c]}${e.properties.i}">${e.properties.s}</a><br><b>Source</b>: ${e.properties.r}`)}})})),Object.keys(t).forEach((e=>t[e].addTo(map))),t=Object.fromEntries(Object.entries(t).map((function(e){return['<i class="circle" style="background: '+registries[e[0]]+'"></i>'+"&nbsp;"+e[0],e[1]]}))),L.control.layers(null,Object.assign({},Object.fromEntries(Object.keys(wms).map((function(e){return[`<img src='${wms[e].address}?version=1.3.0&request=GetLegendGraphic&format=image/png&layer=${wms[e].layer}'/>&nbsp;${e[0].toUpperCase()}${e.substr(1)}`,wms[e].leaf]}))),t)).addTo(map),document.getElementsByClassName("leaflet-control-layers-overlays")[0].insertAdjacentHTML("beforebegin","<h4><b>SSSIs</b></h4>"),document.getElementsByClassName("leaflet-control-layers-overlays")[0].children[3].insertAdjacentHTML("beforebegin","<p></p><h4><b>Caves</b></h4>")}));let infobox=L.control({position:"bottomright"});infobox.onAdd=function(e){let t=L.DomUtil.create("div","infobox");return t.innerHTML+='<h4>SSSI Cave Entrances</h4>Map of cave features on SSSIs in Great Britain.<br><br>Zoom in for SSSI boundaries. Click on markers for details.<br><br><a href="https://github.com/aricooperdavis/SSSI-Cave-Entrances">Sources and more info</a>.',t},infobox.addTo(map);